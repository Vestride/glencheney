// ------------ JODO ------------
// Module: Carousel
// Version: 1.1
// Modified: 2012-09-07 by Glen Cheney
// Dependencies: jQuery 1.7+, Modernizr, jodo.timer.js
// Optional: jQuery throttle-debounce (only used on window resize)
// ------------------------------
(function(e,t,n,r){"use strict";var i=function(r,i){e.extend(this,e.fn.carousel.defaults,i,e.fn.carousel.settings);var s=function(){var i=this,s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};i.$el=r,i.slides=i.childFilter===null?i.$el.children():i.$el.children(i.childFilter),i.tapOrClick=i.hasTouch?"touchstart":"click",i.transformName=t.prefixed("transform"),i.transitionName=t.prefixed("transition"),i.transitionProperty=t.prefixed("transitionProperty"),i.transitionDuration=t.prefixed("transitionDuration"),i.transitionEasing=t.prefixed("transitionTimingFunction"),i.transitionEnd=s[i.transitionName],i.slideWidth||(i.slideWidth=i.slides.eq(0).outerWidth(!0)),i.$el.height(i.slides.eq(0).outerHeight(!0)),i.transition==="convex"&&!i.hasTransforms3d&&(i.transition="slide",i.$el.css("overflow","hidden")),i.transition==="slide"&&i.loopAround===!1&&(i.transition="container"),i.effects[i.transition].init.call(i),a.call(i),i.showIndexBtns===!0&&o.call(i),u.call(i);var f=e.throttle?e.throttle(200,e.proxy(i._onResize,i)):e.proxy(i._onResize,i);e(n).on("resize",f).on("load",function(){i._onResize(!0)}),i._onResize(),i.slides.find("img, video, embed, object").css({maxWidth:"100%",height:"auto"}),i.timeout&&i.pauseOnHover&&i.$el.hover(function(){i.pause(!0)},function(){i.resume(!0)}),i.slides.length>1&&(i.isCarousel=!0,i.slideToIndex(i.start))},o=function(){var t=this,n=Math.ceil(t.slides.length/t.step),r=0,i=e('<nav class="carousel-controls" />'),s=t.putControlsInside?t.$el:t.$el.parent(),o=function(n){var i=e(n.target).data("index");if(i===t.currIndex)return;if(Math.abs(t.currIndex-i)<2)t.slideToIndex(i*t.step);else{var s=i-t.currIndex,o;r=t.currIndex,s>0?o=setInterval(function(){r++,r<=i?t.slideToIndex(r*t.step):clearInterval(o)},50):o=setInterval(function(){r--,r>=i?t.slideToIndex(r*t.step):clearInterval(o)},50)}},u=e("<ol/>",{"class":t.indexButtonClass,style:"padding: 0;"});t.indexBtns=[];for(;r<n;r++){var a,f=e('<li class="carousel-index-btn" />');t.useTitles&&(a=t.slides.eq(r).data("title")||t.slides.eq(r).attr("title"),f.text(a)),t.indexBtns.push(f),f.data("index",r).appendTo(u).on(t.tapOrClick,o)}i.append(u),s.append(i);if(t.autoCenterIndexBtns){var l=0;u.children().each(function(){l+=e(this).outerWidth(!0)}),u.css({width:l+"px",margin:"auto"})}},u=function(){var e=this,t={startX:null,startY:null,endX:null,endY:null},n=0;e.$el.on("touchstart",function(e){t.startX=e.originalEvent.targetTouches[0].clientX,t.startY=e.originalEvent.targetTouches[0].clientY,t.endX=t.startX,t.endY=t.startY}),e.$el.on("touchmove",function(e){var n=e.originalEvent.targetTouches[0].clientX,r=e.originalEvent.targetTouches[0].clientY,i=Math.abs(t.endX-n),s=Math.abs(t.endY-r);if(i<s)return;e.preventDefault(),t.endX=n,t.endY=r}),e.$el.on("touchend",function(r){var i={},s=t.startX-t.endX,o=t.startY-t.endY,u=Math.abs(s),a=Math.abs(o),f=(new Date).getTime();i.distance=u>a?u:a,i.direction=u<a?o<0?"down":"up":s<0?"right":"left",i.distance>50&&(i.direction==="left"?e.advance():i.direction==="right"&&e.retreat()),f-n<350&&e.trigger(e.doubleTapEvent,[r,e]),n=f})},a=function(){var t,n=this,r="<span/>",i=n.putControlsInside?n.$el:n.$el.parent();n.generateNav?(t=e("<nav/>",{"class":"carousel-btns"}),n.showPrevNextBtns===!0&&n.slides.length>1&&(n.btnNext=e(r,{"class":n.genButtonClass+" "+n.nextButtonClass}),n.prevNextInnerButtonClass===""?n.btnNext.html("&rsaquo;"):e(r,{"class":n.prevNextInnerButtonClass}).html("&rsaquo;").appendTo(n.btnNext),t.append(n.btnNext),n.btnPrev=e(r,{"class":n.genButtonClass+" "+n.prevButtonClass}),n.prevNextInnerButtonClass===""?n.btnPrev.html("&lsaquo;"):e(r,{"class":n.prevNextInnerButtonClass}).html("&lsaquo;").appendTo(n.btnPrev),t.append(n.btnPrev)),i.append(t)):(n.btnNext=e(n.nextButtonClass),n.btnPrev=e(n.prevButtonClass)),n.btnNext.on(n.tapOrClick,function(t){e(t.target).hasClass(n.disabledClass)||n.advance()}),n.btnPrev.on(n.tapOrClick,function(t){e(t.target).hasClass(n.disabledClass)||n.retreat()}),n.showSlideCountTxt===!0&&n.slides.length>1&&(n.slideCountTxt=e(r,{"class":n.slideCountTxtClass}).html([n.slideCountPrefix,n.currIndex,n.slideCountSeparator,n.slides.length].join(" ")),i.append(n.slideCountTxt)),n.canClickElement===!0&&n.slides.each(function(t){e(this).on(n.tapOrClick,function(e){e.preventDefault(),n.slideToIndex(t)})})};s.call(this)};i.prototype.advance=function(){var e=this,t=e.currIndex;e.currIndex+=e.step,e.currIndex>e.slides.length-e.step&&(e.currIndex=0),e.slide(e.currIndex,t,"advance")},i.prototype.retreat=function(){var e=this,t=e.currIndex;e.currIndex-=e.step,e.currIndex<0&&(e.currIndex=e.slides.length-1),e.slide(e.currIndex,t,"retreat")},i.prototype.slideToIndex=function(e){var t=this,n=t.currIndex,r;e===n&&(n=t.slides.length-1),r=e>n?"advance":"retreat",t.currIndex=e,t.slide(t.currIndex,n,r)},i.prototype.slide=function(t,n,r){var i=this,s=-(t*i.slideWidth);i.trigger(i.slideStartEvent,[t,n,r,i]),i.showPrevNextBtns&&i.btnNext&&i.btnPrev&&!i.loopAround&&!i.loop&&(i.btnNext.add(i.btnPrev).filter("."+i.disabledClass).removeClass(i.disabledClass),t===0?i.btnPrev.addClass(i.disabledClass):t===i.slides.length-1&&i.btnNext.addClass(i.disabledClass)),i.showSlideCountTxt&&i.slideCountTxt.html([i.slideCountPrefix,t+1,i.slideCountSeparator,i.slides.length].join(" ")),i._transition(s,t,n,r),i.slides.removeClass(i.activeClass).eq(t).addClass(i.activeClass),i._highlightIndexButton(),i.autoResize&&i._autoResizeHeight(),i.timeout&&(i.timer&&i.timer.clear(),i.timer=e.timer(function(){i.advance()},i.timeout)),i.pausedManually=!1},i.prototype._highlightIndexButton=function(){var t=this,n;t.showIndexBtns===!0&&t.indexBtns.length>0&&(n=e(t.indexBtns[Math.floor(t.currIndex/t.step)]),n.addClass(t.activeClass).siblings().removeClass(t.activeClass))},i.prototype._transition=function(e,t,n,r){var i=this,s=i.slides.eq(t),o=i.slides.eq(n),u=function(){i.trigger(i.slideEndEvent,[t,n,r,i])};i.effects[i.transition].transition.call(i,s,o,r,u,e)},i.prototype._skipTransition=function(e,t,n){var r=this,i,s=e.style[this.transitionDuration];e.style[r.transitionDuration]="0ms",e.style[t]=n,i=e.offsetWidth,e.style[r.transitionDuration]=s},i.prototype.pause=function(e){var t=this,n;if(t.pausedManually)return;n=t.timer.pause(),t.pausedManually=e===r,t.$el.addClass("paused"),t.trigger("paused",[n,t])},i.prototype.resume=function(e){var t=this,n;if(e===r||t.pausedManually===!1)t.pausedManually=!1,n=t.timer.resume(),t.$el.removeClass("paused"),t.trigger("resumed",[n,t])},i.prototype._onResize=function(){var e=this,t=0,n=e.slides.eq(e.currIndex);e.slideWidth=e.$el.parent().outerWidth(!0),e.transition==="container"?(e.slides.css("width",e.slideWidth),e.$el.width(e.slides.length*e.slideWidth)):e.$el.width(e.slideWidth),t=n.outerHeight();if(t===0)return;e.slideHeight=t,e.$el.height(e.slideHeight)},i.prototype._autoResizeHeight=function(){var e=this,t=e.slides.eq(e.currIndex);e.$el.animate({height:t.outerHeight(!0)},e.duration/2,e.jsEasing)},i.prototype.getPrefixed=function(e){return this.prefix(t.prefixed(e))},i.prototype.prefix=function(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-")},i.prototype.trigger=function(e,t){this.$el.trigger(e+"."+this.Carousel,t)},i.prototype.effects={},i.prototype.effects.container={init:function(){var e=this;e.slides.css("float","left"),e.$el.width(e.slideWidth*e.slides.length),e.isCSS&&e.hasTransforms?e.$el.css(e.transitionName,e.prefix(e.transformName)+" "+e.duration+"ms "+e.cssEasing):e.$el.css("marginLeft",e.start*e.slideWidth)},transition:function(e,t,n,r,i){var s=this,o=s.hasTransforms?s.transformName:"marginLeft",u;s.isCSS?(s.hasTransforms3d?u="translate3d("+i+"px, 0, 0)":s.hasTransforms?u="translate("+i+"px, 0)":u=i+"px",s.$el.css(o,u).one(s.transitionEnd,r)):s.$el.animate({marginLeft:i},s.duration,s.jsEasing,r)}},i.prototype.effects.slide={init:function(){var e=this;e.slides.each(function(t){var n=t*e.slideWidth+"px",r=e.hasTransforms?e.transformName:"left",i;this.style.position="absolute",this.style.top=0,this.style.left=0,this.style.zIndex=1,e.isCSS?(e.hasTransforms3d?i="translate3d("+n+", 0, 0)":e.hasTransforms?i="translate("+n+", 0)":i=n,this.style[r]=i,this.style[e.transitionName]=e.prefix(r)+" "+e.duration+"ms "+e.cssEasing):this.style.left=n})},transition:function(e,t,n,r){var i=this,s,o=e[0],u=t[0],a=n==="advance"?i.slideWidth:-i.slideWidth,f=-1*a;if(i.isCSS){var l,c,h;s=i.hasTransforms?i.transformName:"left",i.hasTransforms3d?(l="translate3d("+a+"px, 0, 0)",c="translate3d(0, 0, 0)",h="translate3d("+f+"px, 0, 0)"):i.hasTransforms?(l="translate("+a+"px, 0)",c="translate(0, 0)",h="translate("+f+"px, 0)"):(l=a+"px",c=0,h=f+"px"),i._skipTransition(o,s,l),u&&(u.style[s]=h,u.style.zIndex=1),o.style[s]=c,o.style.zIndex=2,e.one(i.transitionEnd,r)}else e.css("left",a+"px"),e.animate({left:0},i.duration,i.jsEasing),t.animate({left:f+"px"},i.duration,i.jsEasing)}},i.prototype.effects.fade={init:function(){var t=this;t.slides.each(function(n){this.style.position="absolute",this.style.top=0,this.style.left=0,this.style.zIndex=1,t.isCSS?(this.style.opacity=0,this.style[t.transitionName]="opacity "+t.duration+"ms "+t.cssEasing):e(this).fadeOut()})},transition:function(e,t,n,r){var i=this;i.isCSS?(t.css({opacity:0,zIndex:1}),e.css({opacity:1,zIndex:2}).one(i.transitionEnd,r)):(t.css({zIndex:1}).fadeOut(i.duration),e.css({zIndex:2}).fadeIn(i.duration,r))}},i.prototype.effects.convex={init:function(){var e=this;e.slides.each(function(n){this.style.position="absolute",this.style.top=0,this.style.left=0,this.style[e.transitionName]="all "+e.duration+"ms "+e.cssEasing,this.style[t.prefixed("transformStyle")]="preserve-3d",this.style.zIndex=1,this.parentNode.style[t.prefixed("perspective")]="600px",this.style[e.transformName]="translate3d(100%, 0, 0) rotateY(90deg) translate3d(100%, 0, 0)",this.style.opacity=0})},transition:function(e,t,n,r){var i=this,s=e[0],o=t[0],u="translate3d(100%, 0, 0) rotateY(90deg) translate3d(100%, 0, 0)",a="translate3d(-100%, 0, 0) rotateY(-90deg) translate3d(-100%, 0, 0)",f,l;n==="advance"?(f=u,l=a):(f=a,l=u),i._skipTransition(s,i.transformName,f),o&&(o.style[i.transformName]=l,o.style.opacity=0),s.style[i.transformName]="",s.style.opacity=1,e.one(i.transitionEnd,r)}},e.fn.carousel=function(t){return this.each(function(){var n=e(this),r=n.data("carousel");r||(r=new i(n,t),n.data("carousel",r)),typeof t=="string"&&r[t]()})},e.fn.carousel.defaults={childFilter:null,step:1,start:0,generateNav:!0,genButtonClass:"carousel-btn",prevButtonClass:"carousel-btn-prev",nextButtonClass:"carousel-btn-next",prevNextInnerButtonClass:"",indexButtonClass:"carousel-index-btns",slideCountTxtClass:"carousel-slide-count-txt",activeClass:"s-selected",disabledClass:"s-disabled",showPrevNextBtns:!0,putControlsInside:!1,showSlideCountTxt:!1,slideCountPrefix:"",slideCountSeparator:"of",showIndexBtns:!0,useTitles:!1,autoCenterIndexBtns:!1,autoResize:!1,canClickElement:!1,transition:"slide",duration:300,cssEasing:"ease-out",jsEasing:"swing",loop:!0,loopAround:null,timeout:0,pauseOnHover:!1},e.fn.carousel.settings={isCSS:t.csstransitions,hasTransforms:t.csstransforms,hasTransforms3d:t.csstransforms3d,hasTouch:t.touch,Carousel:"Carousel",slideEndEvent:"slideEnd",slideStartEvent:"slideStart",doubleTapEvent:"doubleTap",indexBtns:[],isCarousel:!1,currIndex:0,timer:null}})(jQuery,Modernizr,window)